<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Doge Whale Game</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background: linear-gradient(to bottom, #4169E1, #000080);
            color: white;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        header {
            background-color: rgba(0, 0, 128, 0.7);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        h1 {
            margin: 0;
            font-size: 24px;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .coin-display {
            display: flex;
            align-items: center;
            gap: 5px;
            background-color: rgba(0, 0, 0, 0.3);
            padding: 5px 10px;
            border-radius: 20px;
        }
        
        .coin-icon {
            width: 20px;
            height: 20px;
            background-color: gold;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            color: #333;
        }
        
        .nav-buttons {
            display: flex;
            gap: 10px;
        }
        
        .nav-button {
            background-color: rgba(65, 105, 225, 0.7);
            border: 2px solid #87CEEB;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .nav-button:hover {
            background-color: rgba(135, 206, 235, 0.7);
            transform: scale(1.05);
        }
        
        main {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }
        
        #game-container {
            position: relative;
            width: 800px;
            height: 500px;
            background-color: rgba(30, 144, 255, 0.3);
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            overflow: hidden;
        }
        
        #game-canvas {
            width: 100%;
            height: 100%;
            display: block;
        }
        
        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 128, 0.7);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s;
        }
        
        .overlay.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .overlay h2 {
            font-size: 36px;
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }
        
        .overlay p {
            font-size: 18px;
            margin-bottom: 30px;
            max-width: 80%;
            text-align: center;
        }
        
        .button {
            background-color: #4169E1;
            color: white;
            border: none;
            padding: 10px 30px;
            font-size: 18px;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        }
        
        .button:hover {
            background-color: #87CEEB;
            transform: scale(1.05);
        }
        
        #hud {
            position: absolute;
            top: 10px;
            left: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .bar-container {
            width: 200px;
            height: 20px;
            background-color: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            overflow: hidden;
        }
        
        #health-bar {
            height: 100%;
            width: 100%;
            background: linear-gradient(to right, #FF4500, #FF8C00);
            transition: width 0.3s;
        }
        
        #power-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(to right, #4169E1, #00BFFF);
            transition: width 0.3s;
        }
        
        #score-display {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 36px;
            font-weight: bold;
            color: white;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        }
        
        #combo-display {
            position: absolute;
            top: 50px;
            right: 10px;
            font-size: 24px;
            color: gold;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        #power-up-notification {
            position: absolute;
            top: 100px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 18px;
            opacity: 0;
            transition: opacity 0.3s, transform 0.3s;
        }
        
        #mobile-controls {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: flex;
            gap: 20px;
        }
        
        .mobile-button {
            width: 50px;
            height: 50px;
            background-color: rgba(0, 0, 0, 0.5);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 24px;
            cursor: pointer;
            user-select: none;
        }
        
        #combat-controls {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 20px;
        }
        
        .combat-button {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 24px;
            cursor: pointer;
            user-select: none;
        }
        
        #combat-fire {
            background-color: rgba(255, 69, 0, 0.7);
        }
        
        #combat-special {
            background-color: rgba(65, 105, 225, 0.7);
        }
        
        #orientation-toggle {
            position: absolute;
            bottom: 20px;
            left: 20px;
            width: 40px;
            height: 40px;
            background-color: rgba(0, 0, 0, 0.5);
            border-radius: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
        }
        
        .vertical #game-container {
            width: 400px;
            height: 600px;
        }
        
        .background-particle {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            pointer-events: none;
            animation: float var(--duration) linear infinite;
        }
        
        @keyframes float {
            0% {
                transform: translateY(100vh);
            }
            100% {
                transform: translateY(-100px);
            }
        }
        
        .cloud {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: 50%;
            pointer-events: none;
            animation: drift 30s linear infinite;
        }
        
        @keyframes drift {
            0% {
                transform: translateX(-100px);
            }
            100% {
                transform: translateX(100vw);
            }
        }
        
        .water-wave {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 50px;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%230099ff" fill-opacity="0.5" d="M0,192L48,197.3C96,203,192,213,288,229.3C384,245,480,267,576,250.7C672,235,768,181,864,181.3C960,181,1056,235,1152,234.7C1248,235,1344,181,1392,154.7L1440,128L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>');
            background-size: cover;
            animation: wave 10s linear infinite;
        }
        
        @keyframes wave {
            0% {
                background-position-x: 0;
            }
            100% {
                background-position-x: 1000px;
            }
        }
        
        #cloud-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100px;
            overflow: hidden;
            pointer-events: none;
        }
        
        /* Admin Panel Styles */
        #admin-button {
            background-color: rgba(128, 0, 128, 0.7);
            border: 2px solid #E6E6FA;
        }
        
        #admin-overlay {
            background-color: rgba(0, 0, 128, 0.9);
            z-index: 20;
        }
        
        .admin-section {
            background-color: rgba(65, 105, 225, 0.5);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            width: 80%;
            max-width: 600px;
        }
        
        .admin-section h3 {
            margin-top: 0;
            border-bottom: 1px solid #87CEEB;
            padding-bottom: 10px;
        }
        
        .admin-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .admin-control {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .admin-control label {
            min-width: 150px;
        }
        
        .admin-control input[type="number"],
        .admin-control input[type="text"] {
            background-color: rgba(0, 0, 0, 0.3);
            border: 1px solid #87CEEB;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
        }
        
        .admin-control input[type="checkbox"] {
            width: 20px;
            height: 20px;
        }
        
        .admin-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        
        /* Spinner Wheel Styles */
        #spinner-overlay {
            background-color: rgba(0, 0, 128, 0.8);
            z-index: 15;
        }
        
        #spinner-container {
            position: relative;
            width: 300px;
            height: 300px;
            margin-bottom: 30px;
        }
        
        #spinner-wheel {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            position: relative;
            overflow: hidden;
            transition: transform 3s cubic-bezier(0.17, 0.67, 0.83, 0.67);
            transform: rotate(0deg);
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }
        
        .wheel-section {
            position: absolute;
            width: 50%;
            height: 50%;
            transform-origin: bottom right;
            clip-path: polygon(0 0, 100% 0, 0 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px black;
        }
        
        .wheel-section span {
            position: absolute;
            transform: rotate(45deg) translateX(70px) rotate(-45deg);
            font-size: 16px;
        }
        
        #spinner-arrow {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-top: 30px solid red;
            z-index: 1;
        }
        
        #spin-button {
            margin-top: 20px;
            background-color: #FF4500;
        }
        
        #spin-button:hover {
            background-color: #FF8C00;
        }
        
        #spin-result {
            font-size: 24px;
            font-weight: bold;
            color: gold;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
            margin-top: 20px;
            height: 30px;
        }
        
        #spin-timer {
            font-size: 16px;
            color: #87CEEB;
            margin-top: 10px;
        }
        
        /* Lottery/Scratch Styles */
        #lottery-overlay {
            background-color: rgba(0, 0, 128, 0.8);
            z-index: 15;
        }
        
        #lottery-container {
            width: 80%;
            max-width: 500px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        #lottery-info {
            text-align: center;
            margin-bottom: 20px;
        }
        
        #lottery-cards {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .lottery-card {
            width: 100px;
            height: 150px;
            background-color: rgba(65, 105, 225, 0.7);
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: all 0.3s;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        }
        
        .lottery-card:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(135, 206, 235, 0.7);
        }
        
        .lottery-card-cover {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #4169E1, #87CEEB);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            color: white;
            z-index: 1;
            transition: opacity 0.5s;
        }
        
        .lottery-card-content {
            font-size: 20px;
            font-weight: bold;
            color: gold;
            text-shadow: 1px 1px 2px black;
        }
        
        #lottery-result {
            font-size: 24px;
            font-weight: bold;
            color: gold;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
            margin-top: 20px;
            height: 30px;
        }
        
        #lottery-button {
            margin-top: 20px;
            background-color: #4169E1;
        }
        
        #lottery-button:hover {
            background-color: #87CEEB;
        }
        
        @media (max-width: 768px) {
            #game-container {
                width: 100%;
                height: 100%;
                border-radius: 0;
            }
            
            header {
                padding: 5px 10px;
            }
            
            h1 {
                font-size: 18px;
            }
            
            .nav-button {
                padding: 3px 10px;
                font-size: 14px;
            }
            
            #hud {
                top: 5px;
                left: 5px;
            }
            
            .bar-container {
                width: 150px;
                height: 15px;
            }
            
            #score-display {
                font-size: 24px;
            }
            
            #combo-display {
                font-size: 18px;
            }
            
            .mobile-button, .combat-button {
                width: 40px;
                height: 40px;
                font-size: 18px;
            }
            
            #spinner-container {
                width: 250px;
                height: 250px;
            }
            
            .admin-section {
                width: 90%;
                padding: 10px;
            }
            
            .lottery-card {
                width: 80px;
                height: 120px;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
</head>
<body>
    <header>
        <h1>Doge Whale Game</h1>
        <div class="nav-buttons">
            <button class="nav-button" id="play-button">Play</button>
            <button class="nav-button" id="store-button">Store</button>
            <button class="nav-button" id="spinner-button">Spinner</button>
            <button class="nav-button" id="lottery-button-nav">Lottery</button>
            <button class="nav-button" id="leaderboard-button">Leaderboard</button>
            <button class="nav-button" id="admin-button"><i class="fas fa-cog"></i></button>
        </div>
        <div class="user-info">
            <span>Guest</span>
            <div class="coin-display">
                <div class="coin-icon">$</div>
                <span id="coin-count">0</span>
            </div>
        </div>
    </header>
    
    <main>
        <div id="game-container">
            <canvas id="game-canvas"></canvas>
            
            <div id="hud">
                <div class="bar-container">
                    <div id="health-bar"></div>
                </div>
                <div class="bar-container">
                    <div id="power-bar"></div>
                </div>
            </div>
            
            <div id="score-display">0</div>
            <div id="combo-display">Combo x1</div>
            <div id="power-up-notification"></div>
            
            <div id="mobile-controls">
                <div class="mobile-button" id="mobile-up"><i class="fas fa-arrow-up"></i></div>
                <div class="mobile-button" id="mobile-down"><i class="fas fa-arrow-down"></i></div>
            </div>
            
            <div id="combat-controls">
                <div class="combat-button" id="combat-fire"><i class="fas fa-bolt"></i></div>
                <div class="combat-button" id="combat-special"><i class="fas fa-star"></i></div>
            </div>
            
            <div class="overlay active" id="start-overlay">
                <h2>Doge Whale Game</h2>
                <p>Navigate through pipes and defeat enemy whales!</p>
                <button class="button" id="start-button">Start Game</button>
            </div>
            
            <div class="overlay" id="game-over-overlay">
                <h2>Game Over</h2>
                <p>Your score: <span id="final-score">0</span></p>
                <button class="button" id="restart-button">Play Again</button>
            </div>
            
            <!-- Spinner Wheel Overlay -->
            <div class="overlay" id="spinner-overlay">
                <h2>Spin & Win</h2>
                <p>Spin the wheel to win DWHL coins!</p>
                
                <div id="spinner-container">
                    <div id="spinner-arrow"></div>
                    <div id="spinner-wheel">
                        <!-- Wheel sections will be generated by JavaScript -->
                    </div>
                </div>
                
                <div id="spin-result"></div>
                <div id="spin-timer"></div>
                <button class="button" id="spin-button">SPIN</button>
                <button class="button" id="spinner-close-button">Close</button>
            </div>
            
            <!-- Lottery/Scratch Overlay -->
            <div class="overlay" id="lottery-overlay">
                <h2>DWHL Lottery</h2>
                <div id="lottery-container">
                    <div id="lottery-info">
                        <p>Pay 5 DWHL to enter the lottery pool.</p>
                        <p>One lucky player wins the entire pool (up to 200 DWHL)!</p>
                    </div>
                    
                    <div id="lottery-cards">
                        <!-- Lottery cards will be generated by JavaScript -->
                    </div>
                    
                    <div id="lottery-result"></div>
                    <button class="button" id="lottery-button">Enter Lottery (5 DWHL)</button>
                    <button class="button" id="lottery-close-button">Close</button>
                </div>
            </div>
            
            <!-- Admin Panel Overlay -->
            <div class="overlay" id="admin-overlay">
                <h2>Admin Panel</h2>
                
                <div class="admin-section">
                    <h3>Spinner Settings</h3>
                    <div class="admin-controls">
                        <div class="admin-control">
                            <label>Min DWHL Prize:</label>
                            <input type="number" id="admin-spinner-min" min="1" max="100" value="1">
                        </div>
                        <div class="admin-control">
                            <label>Max DWHL Prize:</label>
                            <input type="number" id="admin-spinner-max" min="1" max="100" value="100">
                        </div>
                        <div class="admin-control">
                            <label>Cooldown Hours:</label>
                            <input type="number" id="admin-spinner-cooldown" min="1" max="72" value="24">
                        </div>
                        <div class="admin-control">
                            <label>Enable Spinner:</label>
                            <input type="checkbox" id="admin-spinner-enabled" checked>
                        </div>
                    </div>
                </div>
                
                <div class="admin-section">
                    <h3>Lottery Settings</h3>
                    <div class="admin-controls">
                        <div class="admin-control">
                            <label>Entry Fee (DWHL):</label>
                            <input type="number" id="admin-lottery-fee" min="1" max="50" value="5">
                        </div>
                        <div class="admin-control">
                            <label>Max Pool Size (DWHL):</label>
                            <input type="number" id="admin-lottery-max" min="10" max="1000" value="200">
                        </div>
                        <div class="admin-control">
                            <label>Enable Lottery:</label>
                            <input type="checkbox" id="admin-lottery-enabled" checked>
                        </div>
                    </div>
                </div>
                
                <div class="admin-section">
                    <h3>DWHL Settings</h3>
                    <div class="admin-controls">
                        <div class="admin-control">
                            <label>Withdrawal Minimum:</label>
                            <input type="number" id="admin-withdrawal-min" min="100" max="10000" value="1000">
                        </div>
                        <div class="admin-control">
                            <label>Starting DWHL:</label>
                            <input type="number" id="admin-starting-dwhl" min="0" max="1000" value="10">
                        </div>
                    </div>
                </div>
                
                <div class="admin-buttons">
                    <button class="button" id="admin-save-button">Save Settings</button>
                    <button class="button" id="admin-close-button">Close</button>
                </div>
            </div>
            
            <div class="water-wave"></div>
            <div id="cloud-container"></div>
        </div>
    </main>
    
    <div id="orientation-toggle">
        <i class="fas fa-mobile-alt"></i>
    </div>
    
    <script>
        // Game state and variables
        let gameState = {
            score: 0,
            health: 100,
            power: 0,
            combo: 1,
            coins: 0,
            isPlaying: false,
            lastSpinTime: 0,
            lotteryPool: 0,
            lotteryEntries: []
        };
        
        // Admin settings with default values
        let adminSettings = {
            spinner: {
                minPrize: 1,
                maxPrize: 100,
                cooldownHours: 24,
                enabled: true
            },
            lottery: {
                entryFee: 5,
                maxPool: 200,
                enabled: true
            },
            dwhl: {
                withdrawalMin: 1000,
                startingAmount: 10
            }
        };
        
        // Load saved settings from localStorage if available
        function loadSettings() {
            const savedSettings = localStorage.getItem('dogeWhaleAdminSettings');
            if (savedSettings) {
                adminSettings = JSON.parse(savedSettings);
                
                // Update admin panel inputs
                document.getElementById('admin-spinner-min').value = adminSettings.spinner.minPrize;
                document.getElementById('admin-spinner-max').value = adminSettings.spinner.maxPrize;
                document.getElementById('admin-spinner-cooldown').value = adminSettings.spinner.cooldownHours;
                document.getElementById('admin-spinner-enabled').checked = adminSettings.spinner.enabled;
                
                document.getElementById('admin-lottery-fee').value = adminSettings.lottery.entryFee;
                document.getElementById('admin-lottery-max').value = adminSettings.lottery.maxPool;
                document.getElementById('admin-lottery-enabled').checked = adminSettings.lottery.enabled;
                
                document.getElementById('admin-withdrawal-min').value = adminSettings.dwhl.withdrawalMin;
                document.getElementById('admin-starting-dwhl').value = adminSettings.dwhl.startingAmount;
            }
            
            // Update UI based on settings
            document.getElementById('spinner-button').style.display = adminSettings.spinner.enabled ? 'block' : 'none';
            document.getElementById('lottery-button-nav').style.display = adminSettings.lottery.enabled ? 'block' : 'none';
        }
        
        // Save settings to localStorage
        function saveSettings() {
            adminSettings.spinner.minPrize = parseInt(document.getElementById('admin-spinner-min').value);
            adminSettings.spinner.maxPrize = parseInt(document.getElementById('admin-spinner-max').value);
            adminSettings.spinner.cooldownHours = parseInt(document.getElementById('admin-spinner-cooldown').value);
            adminSettings.spinner.enabled = document.getElementById('admin-spinner-enabled').checked;
            
            adminSettings.lottery.entryFee = parseInt(document.getElementById('admin-lottery-fee').value);
            adminSettings.lottery.maxPool = parseInt(document.getElementById('admin-lottery-max').value);
            adminSettings.lottery.enabled = document.getElementById('admin-lottery-enabled').checked;
            
            adminSettings.dwhl.withdrawalMin = parseInt(document.getElementById('admin-withdrawal-min').value);
            adminSettings.dwhl.startingAmount = parseInt(document.getElementById('admin-starting-dwhl').value);
            
            localStorage.setItem('dogeWhaleAdminSettings', JSON.stringify(adminSettings));
            
            // Update UI based on settings
            document.getElementById('spinner-button').style.display = adminSettings.spinner.enabled ? 'block' : 'none';
            document.getElementById('lottery-button-nav').style.display = adminSettings.lottery.enabled ? 'block' : 'none';
            
            showNotification('Settings saved successfully!');
        }
        
        // Load game state from localStorage
        function loadGameState() {
            const savedState = localStorage.getItem('dogeWhaleGameState');
            if (savedState) {
                const parsedState = JSON.parse(savedState);
                gameState = {...gameState, ...parsedState};
            } else {
                // Set starting coins from admin settings
                gameState.coins = adminSettings.dwhl.startingAmount;
            }
            
            // Update UI
            document.getElementById('coin-count').textContent = gameState.coins;
        }
        
        // Save game state to localStorage
        function saveGameState() {
            localStorage.setItem('dogeWhaleGameState', JSON.stringify(gameState));
        }
        
        // Show notification
        function showNotification(message) {
            const notification = document.getElementById('power-up-notification');
            notification.textContent = message;
            notification.style.opacity = 1;
            notification.style.transform = 'translateY(-20px)';
            
            setTimeout(() => {
                notification.style.opacity = 0;
                notification.style.transform = 'translateY(0)';
            }, 3000);
        }
        
        // Update coin display
        function updateCoins(amount) {
            gameState.coins += amount;
            document.getElementById('coin-count').textContent = gameState.coins;
            saveGameState();
            
            if (amount > 0) {
                showNotification(`+${amount} DWHL coins!`);
            } else if (amount < 0) {
                showNotification(`${amount} DWHL coins`);
            }
        }
        
        // Check if spinner is available (cooldown period)
        function isSpinnerAvailable() {
            const now = Date.now();
            const cooldownMs = adminSettings.spinner.cooldownHours * 60 * 60 * 1000;
            return (now - gameState.lastSpinTime) >= cooldownMs;
        }
        
        // Format time remaining for spinner cooldown
        function formatTimeRemaining() {
            const now = Date.now();
            const cooldownMs = adminSettings.spinner.cooldownHours * 60 * 60 * 1000;
            const elapsed = now - gameState.lastSpinTime;
            const remaining = cooldownMs - elapsed;
            
            if (remaining <= 0) return "Available now!";
            
            const hours = Math.floor(remaining / (60 * 60 * 1000));
            const minutes = Math.floor((remaining % (60 * 60 * 1000)) / (60 * 1000));
            const seconds = Math.floor((remaining % (60 * 1000)) / 1000);
            
            return `Available in: ${hours}h ${minutes}m ${seconds}s`;
        }
        
        // Create spinner wheel sections
        function createSpinnerWheel() {
            const wheel = document.getElementById('spinner-wheel');
            wheel.innerHTML = '';
            
            // Define colors for wheel sections
            const colors = [
                '#FF4500', '#4169E1', '#32CD32', '#FFD700', 
                '#9932CC', '#FF8C00', '#00BFFF', '#FF1493'
            ];
            
            // Create 8 sections with random DWHL values
            for (let i = 0; i < 8; i++) {
                const section = document.createElement('div');
                section.className = 'wheel-section';
                section.style.backgroundColor = colors[i];
                section.style.transform = `rotate(${i * 45}deg)`;
                
                // Generate random DWHL value within admin settings range
                const min = adminSettings.spinner.minPrize;
                const max = adminSettings.spinner.maxPrize;
                const value = Math.floor(Math.random() * (max - min + 1)) + min;
                
                const span = document.createElement('span');
                span.textContent = `${value} DWHL`;
                section.appendChild(span);
                section.dataset.value = value;
                
                wheel.appendChild(section);
            }
        }
        
        // Spin the wheel
        function spinWheel() {
            if (!isSpinnerAvailable()) {
                document.getElementById('spin-result').textContent = 'Spin not available yet!';
                return;
            }
            
            const wheel = document.getElementById('spinner-wheel');
            const spinButton = document.getElementById('spin-button');
            spinButton.disabled = true;
            
            // Random number of rotations (5-10) plus random section
            const rotations = 5 + Math.floor(Math.random() * 5);
            const extraAngle = Math.floor(Math.random() * 8) * 45;
            const totalAngle = rotations * 360 + extraAngle;
            
            // Spin animation
            wheel.style.transition = 'transform 3s cubic-bezier(0.17, 0.67, 0.83, 0.67)';
            wheel.style.transform = `rotate(${totalAngle}deg)`;
            
            // Calculate which section will be at the top after spinning
            setTimeout(() => {
                // The wheel spins clockwise, so we need to find which section is at the top
                // The section at the top is opposite to the one at the bottom after spinning
                const sectionIndex = Math.floor(((totalAngle % 360) / 45)) % 8;
                const sections = document.querySelectorAll('.wheel-section');
                const winningSection = sections[sectionIndex];
                const prize = parseInt(winningSection.dataset.value);
                
                // Update result and game state
                document.getElementById('spin-result').textContent = `You won ${prize} DWHL!`;
                updateCoins(prize);
                
                // Update last spin time
                gameState.lastSpinTime = Date.now();
                saveGameState();
                
                // Re-enable spin button
                setTimeout(() => {
                    spinButton.disabled = false;
                    updateSpinTimer();
                }, 1000);
            }, 3000);
        }
        
        // Update spin timer display
        function updateSpinTimer() {
            const timerElement = document.getElementById('spin-timer');
            const spinButton = document.getElementById('spin-button');
            
            if (isSpinnerAvailable()) {
                timerElement.textContent = 'Spin available now!';
                spinButton.disabled = false;
            } else {
                timerElement.textContent = formatTimeRemaining();
                spinButton.disabled = true;
                
                // Update timer every second
                setTimeout(updateSpinTimer, 1000);
            }
        }
        
        // Create lottery cards
        function createLotteryCards() {
            const cardsContainer = document.getElementById('lottery-cards');
            cardsContainer.innerHTML = '';
            
            // Create 3 lottery cards
            for (let i = 0; i < 3; i++) {
                const card = document.createElement('div');
                card.className = 'lottery-card';
                card.dataset.index = i;
                
                const cover = document.createElement('div');
                cover.className = 'lottery-card-cover';
                cover.innerHTML = '<i class="fas fa-question"></i>';
                
                const content = document.createElement('div');
                content.className = 'lottery-card-content';
                content.textContent = '?';
                
                card.appendChild(content);
                card.appendChild(cover);
                cardsContainer.appendChild(card);
                
                // Add click event to scratch card
                card.addEventListener('click', function() {
                    scratchCard(this);
                });
            }
        }
        
        // Scratch lottery card
        function scratchCard(card) {
            // Check if lottery is active
            if (!gameState.lotteryActive) return;
            
            // Remove cover to reveal content
            const cover = card.querySelector('.lottery-card-cover');
            cover.style.opacity = 0;
            
            // Disable further scratching
            gameState.lotteryActive = false;
            
            // Determine if this card is a winner
            const isWinner = parseInt(card.dataset.index) === gameState.winningCardIndex;
            const content = card.querySelector('.lottery-card-content');
            
            if (isWinner) {
                const winAmount = gameState.lotteryPool;
                content.textContent = `${winAmount} DWHL`;
                document.getElementById('lottery-result').textContent = `Congratulations! You won ${winAmount} DWHL!`;
                updateCoins(winAmount);
                
                // Reset lottery pool
                gameState.lotteryPool = 0;
            } else {
                content.textContent = '0';
                document.getElementById('lottery-result').textContent = 'Better luck next time!';
            }
            
            // Reveal all other cards after a delay
            setTimeout(() => {
                const allCards = document.querySelectorAll('.lottery-card');
                allCards.forEach(otherCard => {
                    if (otherCard !== card) {
                        const otherCover = otherCard.querySelector('.lottery-card-cover');
                        otherCover.style.opacity = 0;
                        
                        const otherContent = otherCard.querySelector('.lottery-card-content');
                        const isOtherWinner = parseInt(otherCard.dataset.index) === gameState.winningCardIndex;
                        otherContent.textContent = isOtherWinner ? `${gameState.lotteryPool} DWHL` : '0';
                    }
                });
                
                // Re-enable lottery button
                document.getElementById('lottery-button').disabled = false;
            }, 1000);
        }
        
        // Enter lottery
        function enterLottery() {
            // Check if user has enough coins
            const entryFee = adminSettings.lottery.entryFee;
            if (gameState.coins < entryFee) {
                document.getElementById('lottery-result').textContent = `Not enough DWHL! Need ${entryFee} DWHL to enter.`;
                return;
            }
            
            // Deduct entry fee
            updateCoins(-entryFee);
            
            // Add to lottery pool
            gameState.lotteryPool += entryFee;
            if (gameState.lotteryPool > adminSettings.lottery.maxPool) {
                gameState.lotteryPool = adminSettings.lottery.maxPool;
            }
            
            // Reset lottery cards
            createLotteryCards();
            
            // Determine winning card randomly
            gameState.winningCardIndex = Math.floor(Math.random() * 3);
            
            // Activate lottery
            gameState.lotteryActive = true;
            
            // Update UI
            document.getElementById('lottery-result').textContent = 'Scratch a card to reveal your prize!';
            document.getElementById('lottery-button').disabled = true;
        }
        
        // Animation scripts (from original code)
        const mainWhaleSwimFrames = [
            {
                tailAngle: -15,
                finOffset: -2,
                bubbleCount: 1
            },
            {
                tailAngle: -5,
                finOffset: -1,
                bubbleCount: 0
            },
            {
                tailAngle: 0,
                finOffset: 0,
                bubbleCount: 0
            },
            {
                tailAngle: 5,
                finOffset: 1,
                bubbleCount: 2
            },
            {
                tailAngle: 15,
                finOffset: 2,
                bubbleCount: 1
            },
            {
                tailAngle: 5,
                finOffset: 1,
                bubbleCount: 0
            },
            {
                tailAngle: 0,
                finOffset: 0,
                bubbleCount: 0
            },
            {
                tailAngle: -5,
                finOffset: -1,
                bubbleCount: 1
            }
        ];
        
        // Initialize game
        document.addEventListener('DOMContentLoaded', function() {
            // Load settings and game state
            loadSettings();
            loadGameState();
            
            // Initialize spinner wheel
            createSpinnerWheel();
            updateSpinTimer();
            
            // Initialize lottery cards
            createLotteryCards();
            
            // Admin panel event listeners
            document.getElementById('admin-button').addEventListener('click', function() {
                document.getElementById('admin-overlay').classList.add('active');
            });
            
            document.getElementById('admin-close-button').addEventListener('click', function() {
                document.getElementById('admin-overlay').classList.remove('active');
            });
            
            document.getElementById('admin-save-button').addEventListener('click', function() {
                saveSettings();
            });
            
            // Spinner event listeners
            document.getElementById('spinner-button').addEventListener('click', function() {
                document.getElementById('spinner-overlay').classList.add('active');
                updateSpinTimer();
            });
            
            document.getElementById('spinner-close-button').addEventListener('click', function() {
                document.getElementById('spinner-overlay').classList.remove('active');
            });
            
            document.getElementById('spin-button').addEventListener('click', function() {
                spinWheel();
            });
            
            // Lottery event listeners
            document.getElementById('lottery-button-nav').addEventListener('click', function() {
                document.getElementById('lottery-overlay').classList.add('active');
            });
            
            document.getElementById('lottery-close-button').addEventListener('click', function() {
                document.getElementById('lottery-overlay').classList.remove('active');
            });
            
            document.getElementById('lottery-button').addEventListener('click', function() {
                enterLottery();
            });
            
            // Game navigation buttons
            document.getElementById('play-button').addEventListener('click', function() {
                document.getElementById('start-overlay').classList.add('active');
            });
            
            document.getElementById('start-button').addEventListener('click', function() {
                document.getElementById('start-overlay').classList.remove('active');
                // Start game logic would go here
            });
            
            document.getElementById('restart-button').addEventListener('click', function() {
                document.getElementById('game-over-overlay').classList.remove('active');
                document.getElementById('start-overlay').classList.add('active');
            });
            
            // For demo purposes, add some coins button (remove in production)
            document.getElementById('store-button').addEventListener('click', function() {
                updateCoins(50);
                showNotification('Added 50 DWHL coins for demo purposes!');
            });
        });
    </script>
</body>
</html>
